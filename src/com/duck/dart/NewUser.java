package com.duck.dart;

import android.app.Activity;
import android.app.AlertDialog;
import android.content.Context;
import android.content.DialogInterface;
import android.content.Intent;
import android.content.SharedPreferences;
import android.net.ConnectivityManager;
import android.net.NetworkInfo;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;

import com.flurry.android.FlurryAgent;
 
import com.parse.ParseObject;

public class NewUser extends Activity {
	@Override
	public void onCreate(Bundle savedInstanceState) {
	    super.onCreate(savedInstanceState);
//	    this.requestWindowFeature(Window.FEATURE_NO_TITLE);
	    setContentView(R.layout.newuser);
	    Dialog18x();
	    Boolean b;
	    b=isNetworkAvailable();  //true if connection,  false if not
	   if(!b){
	       //do accordingly to no-connection
		     Log.d("no network","no network");
	    	 Toast.makeText(NewUser.this, "??????????????????????????????????????????", Toast.LENGTH_LONG).show();
//	    	 System.exit(0);
	    	   new Thread(new Runnable() {
	               @Override
	               public void run() {
	                   try {
	                       Thread.sleep(5000);
	                   }
	                   catch (Exception e) { }
	                   System.exit(0);
	               }
	           }).start();
	 
	   }else{
	   
	   
	    final EditText userid = (EditText)findViewById(R.id.UserID);
	    Button   signup = (Button) findViewById(R.id.Signup);
	//    final	String UserID = userid.getText().toString();

    	signup.setOnClickListener(new Button.OnClickListener(){ 

             @Override

             public void onClick(View v) {
            		if("".equals(userid.getText().toString())){
	            		Log.d("d","????????????");
	            		Toast.makeText(NewUser.this, "UserID????????????",Toast.LENGTH_SHORT).show();
            		}else if(userid.length() < 2){
            			 
            			Toast.makeText(NewUser.this, "???????????????2????????????",Toast.LENGTH_SHORT).show();
            	        
            		}else{
	            			
            			SharedPreferences settings = getSharedPreferences("Preference", 1);
            			settings.edit().putString("UserID", userid.getText().toString()).commit();
            			String UserID = settings.getString("UserID", "");
            			Log.d("New User Id is",UserID);
 
            			ParseObject it = new ParseObject("User");
						it.put("UserID", UserID);
						it.saveInBackground();
						FlurryAgent.logEvent("New User ID");
			 
		                 startActivity(new Intent(NewUser.this,Privacy.class));
		                 finish();
            			}	 
            
             }         

         });   
	   }
	 }
	public void Dialog18x() {
	//	TextView dialog18x = (TextView)findViewById(R.string.Dialog18x);
		new AlertDialog.Builder(this)
	    .setTitle("???APP????????????????????????????????????")
	    .setMessage("?????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????? ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????18?????????????????????????????????????????????????????????????????????????????????")
	    .setPositiveButton("?????????", new DialogInterface.OnClickListener() {
	        public void onClick(DialogInterface dialog, int which) { 
	            // continue with delete
	        	dialog.dismiss();
	        }
	     })
	    .setNegativeButton("??????18???", new DialogInterface.OnClickListener() {
	        public void onClick(DialogInterface dialog, int which) { 
	            // do nothing
	            finish();
	            System.exit(0);
	        }
	     })
	    .setIcon(R.drawable.dilog18x)
	     .show();
	//	dialog.setFeatureDrawableResource(Window.FEATURE_LEFT_ICON, R.drawable.dilog18x);
	}	 
	@Override
	protected void onStart()
	{
		super.onStart();
		FlurryAgent.onStartSession(this, "85YC8XFWVNR5NJ4B4CJD");
	}
	 
	@Override
	protected void onStop()
	{
		super.onStop();		
		FlurryAgent.onEndSession(this);
	}
	private boolean isNetworkAvailable() {
	    ConnectivityManager connectivityManager 
	          = (ConnectivityManager) getSystemService(Context.CONNECTIVITY_SERVICE);
	    NetworkInfo activeNetworkInfo = connectivityManager.getActiveNetworkInfo();
	    return activeNetworkInfo != null && activeNetworkInfo.isConnected();
	}
}
